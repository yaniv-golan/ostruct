{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "required": [
        "analysis_metadata",
        "scan_summary",
        "vulnerabilities",
        "dependency_issues"
    ],
    "additionalProperties": false,
    "properties": {
        "analysis_metadata": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "approach",
                "template_version",
                "analysis_date",
                "performance"
            ],
            "properties": {
                "approach": {
                    "type": "string",
                    "enum": [
                        "static",
                        "code_interpreter",
                        "hybrid"
                    ],
                    "description": "Analysis approach used (static, code_interpreter, or hybrid)"
                },
                "template_version": {
                    "type": "string",
                    "description": "Version of the analysis template used"
                },
                "analysis_date": {
                    "type": "string",
                    "format": "date-time",
                    "description": "ISO timestamp when analysis was performed"
                },
                "performance": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                        "tokens_used",
                        "estimated_cost"
                    ],
                    "properties": {
                        "tokens_used": {
                            "type": "integer",
                            "description": "Number of tokens consumed during analysis"
                        },
                        "estimated_cost": {
                            "type": "number",
                            "description": "Estimated cost in USD for the analysis"
                        },
                        "analysis_duration_seconds": {
                            "type": "number",
                            "description": "Time taken for analysis in seconds"
                        },
                        "context_utilization": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 100,
                            "description": "Percentage of context window utilized"
                        }
                    }
                },
                "capabilities_used": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "static_analysis",
                            "ast_parsing",
                            "pattern_detection",
                            "code_execution",
                            "cross_validation",
                            "complexity_analysis"
                        ]
                    },
                    "description": "Analysis capabilities that were utilized"
                }
            }
        },
        "scan_summary": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "total_files",
                "files_with_issues",
                "total_vulnerabilities",
                "risk_levels"
            ],
            "properties": {
                "total_files": {
                    "type": "integer",
                    "description": "Total number of files scanned"
                },
                "files_with_issues": {
                    "type": "integer",
                    "description": "Number of files with identified vulnerabilities"
                },
                "total_vulnerabilities": {
                    "type": "integer",
                    "description": "Total number of vulnerabilities found"
                },
                "risk_levels": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                        "critical",
                        "high",
                        "medium",
                        "low"
                    ],
                    "properties": {
                        "critical": {
                            "type": "integer"
                        },
                        "high": {
                            "type": "integer"
                        },
                        "medium": {
                            "type": "integer"
                        },
                        "low": {
                            "type": "integer"
                        }
                    }
                },
                "overall_risk_assessment": {
                    "type": "string",
                    "enum": [
                        "critical",
                        "high",
                        "medium",
                        "low"
                    ],
                    "description": "Overall risk level based on all findings"
                },
                "analysis_quality": {
                    "type": "string",
                    "enum": [
                        "comprehensive",
                        "detailed",
                        "basic"
                    ],
                    "description": "Quality level of the analysis performed"
                }
            }
        },
        "vulnerabilities": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                    "id",
                    "type",
                    "risk_level",
                    "file_path",
                    "line_number",
                    "description",
                    "remediation",
                    "code_snippet",
                    "impact",
                    "references"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the vulnerability"
                    },
                    "type": {
                        "type": "string",
                        "description": "Category of vulnerability (e.g., XSS, SQL Injection)",
                        "enum": [
                            "sql_injection",
                            "xss",
                            "command_injection",
                            "code_injection",
                            "path_traversal",
                            "authentication_bypass",
                            "authorization_flaw",
                            "sensitive_data_exposure",
                            "security_misconfiguration",
                            "dependency_vulnerability",
                            "insecure_deserialization",
                            "logging_issues",
                            "cryptographic_weakness",
                            "race_condition",
                            "business_logic_flaw",
                            "timing_attack",
                            "resource_exhaustion",
                            "privilege_escalation",
                            "other"
                        ]
                    },
                    "risk_level": {
                        "type": "string",
                        "enum": [
                            "critical",
                            "high",
                            "medium",
                            "low"
                        ]
                    },
                    "confidence_score": {
                        "type": "number",
                        "minimum": 0.0,
                        "maximum": 1.0,
                        "description": "Confidence level in the vulnerability finding (0.0-1.0)"
                    },
                    "file_path": {
                        "type": "string",
                        "description": "Path to the file containing the vulnerability"
                    },
                    "line_number": {
                        "type": "integer",
                        "description": "Line number where the vulnerability was found"
                    },
                    "code_snippet": {
                        "type": "string",
                        "description": "Relevant code snippet showing the vulnerability"
                    },
                    "description": {
                        "type": "string",
                        "description": "Detailed description of the vulnerability"
                    },
                    "impact": {
                        "type": "string",
                        "description": "Potential impact if exploited"
                    },
                    "exploitability": {
                        "type": "string",
                        "enum": [
                            "easy",
                            "moderate",
                            "difficult"
                        ],
                        "description": "How easy it is to exploit this vulnerability"
                    },
                    "remediation": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "suggestion",
                            "example"
                        ],
                        "properties": {
                            "suggestion": {
                                "type": "string",
                                "description": "Suggested fix for the vulnerability"
                            },
                            "example": {
                                "type": "string",
                                "description": "Example of secure implementation"
                            },
                            "complexity": {
                                "type": "string",
                                "enum": [
                                    "low",
                                    "medium",
                                    "high"
                                ],
                                "description": "Complexity of implementing the fix"
                            },
                            "priority": {
                                "type": "string",
                                "enum": [
                                    "immediate",
                                    "high",
                                    "medium",
                                    "low"
                                ],
                                "description": "Priority for fixing this vulnerability"
                            }
                        }
                    },
                    "evidence_quality": {
                        "type": "string",
                        "enum": [
                            "comprehensive",
                            "detailed",
                            "basic"
                        ],
                        "description": "Quality of evidence supporting this finding"
                    },
                    "detection_method": {
                        "type": "string",
                        "enum": [
                            "static_analysis",
                            "pattern_matching",
                            "ast_analysis",
                            "dynamic_testing",
                            "cross_validation"
                        ],
                        "description": "Method used to detect this vulnerability"
                    },
                    "references": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "description": "URLs to relevant security documentation"
                        }
                    },
                    "cwe_id": {
                        "type": "string",
                        "pattern": "^CWE-[0-9]+$",
                        "description": "Common Weakness Enumeration identifier"
                    },
                    "owasp_category": {
                        "type": "string",
                        "description": "OWASP Top 10 category if applicable"
                    }
                }
            }
        },
        "dependency_issues": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                    "package",
                    "version",
                    "vulnerabilities"
                ],
                "properties": {
                    "package": {
                        "type": "string",
                        "description": "Name of the vulnerable package"
                    },
                    "version": {
                        "type": "string",
                        "description": "Current version of the package"
                    },
                    "vulnerabilities": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "additionalProperties": false,
                            "required": [
                                "cve",
                                "severity",
                                "description",
                                "fixed_version"
                            ],
                            "properties": {
                                "cve": {
                                    "type": "string",
                                    "description": "CVE identifier"
                                },
                                "severity": {
                                    "type": "string",
                                    "enum": [
                                        "critical",
                                        "high",
                                        "medium",
                                        "low"
                                    ]
                                },
                                "description": {
                                    "type": "string",
                                    "description": "Description of the vulnerability"
                                },
                                "fixed_version": {
                                    "type": "string",
                                    "description": "Version that fixes the vulnerability"
                                },
                                "cvss_score": {
                                    "type": "number",
                                    "minimum": 0.0,
                                    "maximum": 10.0,
                                    "description": "CVSS score for the vulnerability"
                                }
                            }
                        }
                    }
                }
            }
        },
        "quality_metrics": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "code_complexity": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "average_score": {
                            "type": "number",
                            "description": "Average complexity score across all files"
                        },
                        "high_complexity_files": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "file_path": {
                                        "type": "string"
                                    },
                                    "complexity_score": {
                                        "type": "number"
                                    }
                                }
                            }
                        }
                    }
                },
                "code_coverage": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "lines_analyzed": {
                            "type": "integer",
                            "description": "Total lines of code analyzed"
                        },
                        "functions_analyzed": {
                            "type": "integer",
                            "description": "Total functions analyzed"
                        },
                        "coverage_percentage": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 100,
                            "description": "Percentage of code covered by analysis"
                        }
                    }
                }
            }
        },
        "cross_validation_results": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "static_vs_dynamic": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "confirmed_vulnerabilities": {
                            "type": "integer",
                            "description": "Vulnerabilities confirmed by both methods"
                        },
                        "static_only": {
                            "type": "integer",
                            "description": "Vulnerabilities found only by static analysis"
                        },
                        "dynamic_only": {
                            "type": "integer",
                            "description": "Vulnerabilities found only by dynamic analysis"
                        },
                        "confidence_boost": {
                            "type": "number",
                            "description": "Average confidence boost from cross-validation"
                        }
                    }
                }
            },
            "description": "Results from cross-validation (hybrid approach only)"
        }
    }
}

Perform a comprehensive security vulnerability scan on the following files:

## Files for Analysis
- Code files: {{ file_ref("code_files") }}
{% if safe_get('dependency_files') %}
- Dependencies: {{ file_ref("dependency_files") }}
{% endif %}
{% if safe_get('config_files') %}
- Configuration: {{ file_ref("config_files") }}
{% endif %}

## Scan Parameters
- Scan Type: {{ safe_get('scan_type', 'full') }}
- Specific Rules: {{ safe_get('rules', []) | join(', ') }}
- Minimum Severity: {{ safe_get('min_severity', 'low') }}
- Exclude Patterns: {{ safe_get('exclude_patterns', []) | join(', ') }}

Please analyze the provided code for security vulnerabilities, focusing on:
1. Identifying potential security issues in the application code
2. Checking for known vulnerabilities in dependencies
3. Validating security-related configurations
4. Suggested specific remediation steps for each issue

Provide your analysis in the following JSON format, adhering to the schema:
{
  "scan_summary": {
    "total_files": <number>,
    "files_with_issues": <number>,
    "total_vulnerabilities": <number>,
    "risk_levels": {
      "critical": <number>,
      "high": <number>,
      "medium": <number>,
      "low": <number>
    }
  },
  "vulnerabilities": [
    {
      "id": "<unique_id>",
      "type": "<vulnerability_type>",
      "risk_level": "<severity>",
      "file_path": "<file_path>",
      "line_number": <line_number>,
      "code_snippet": "<relevant_code>",
      "description": "<detailed_description>",
      "impact": "<potential_impact>",
      "remediation": {
        "suggestion": "<fix_suggestion>",
        "example": "<example_code>"
      },
      "references": [
        "<reference_urls>"
      ]
    }
  ],
  "dependency_issues": [
    {
      "package": "<package_name>",
      "version": "<current_version>",
      "vulnerabilities": [
        {
          "cve": "<cve_id>",
          "severity": "<severity_level>",
          "description": "<vulnerability_description>",
          "fixed_version": "<version_with_fix>"
        }
      ]
    }
  ]
}

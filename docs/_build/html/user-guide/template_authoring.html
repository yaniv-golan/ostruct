<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Authoring Guide &mdash; ostruct-cli  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx-design.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security Overview" href="../security/overview.html" />
    <link rel="prev" title="CLI Reference" href="cli_reference.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../index.html" class="icon icon-home">
            ostruct-cli
          </a>
              <div class="version">
                0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">📖 User Guides:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to ostruct</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">CLI Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#file-routing-options">File Routing Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#advanced-file-routing">Advanced File Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#variables-and-input">Variables and Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#model-and-api-configuration">Model and API Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#system-prompts">System Prompts</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#security-and-path-management">Security and Path Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#mcp-server-integration">MCP Server Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#output-and-execution-control">Output and Execution Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#file-routing-examples">File Routing Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#migration-from-legacy-syntax">Migration from Legacy Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#best-practices">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#common-workflows">Common Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Template Authoring Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#template-basics">Template Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#template-structure">Template Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-template-example">Basic Template Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#variables-and-data-access">Variables and Data Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#variable-sources">Variable Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#file-variables">File Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#understanding-file-routing">Understanding File Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-naming-rules">Variable Naming Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#auto-naming-examples">Auto-Naming Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-variable-names">Custom Variable Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fileinfo-object-structure">FileInfo Object Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directory-and-pattern-processing">Directory and Pattern Processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#cli-variables">CLI Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#string-variables">String Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#json-variables">JSON Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#control-structures">Control Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#conditional-logic">Conditional Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loops-and-iteration">Loops and Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filtering-and-grouping">Filtering and Grouping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#template-filters">Template Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#text-processing-filters">Text Processing Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-processing-filters">Data Processing Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-processing-filters">Code Processing Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-and-data-formatting">Table and Data Formatting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#global-functions">Global Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#token-estimation">Token Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#utility-functions">Utility Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#system-prompts-and-frontmatter">System Prompts and Frontmatter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#yaml-frontmatter">YAML Frontmatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-prompt-best-practices">System Prompt Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#advanced-template-patterns">Advanced Template Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#multi-file-analysis-template">Multi-File Analysis Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-comparison-template">Configuration Comparison Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-analysis-template">Data Analysis Template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#tool-integration-variables">Tool Integration Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#code-interpreter-context">Code Interpreter Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-search-context">File Search Context</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#template-organization-and-reuse">Template Organization and Reuse</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#template-libraries">Template Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reusable-template-snippets">Reusable Template Snippets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#template-testing-and-debugging">Template Testing and Debugging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dry-run-testing">Dry Run Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug-variables">Debug Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-template-issues">Common Template Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#template-design">Template Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance-optimization">Performance Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling">Error Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🔒 Security:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html">Security Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#security-architecture">Security Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#api-key-management">API Key Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#file-access-control">File Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#data-upload-and-tool-security">Data Upload and Tool Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#mcp-server-security">MCP Server Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#threat-model-and-risk-assessment">Threat Model and Risk Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#production-security-checklist">Production Security Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#security-configuration-examples">Security Configuration Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#security-resources">Security Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/overview.html#getting-security-help">Getting Security Help</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ostruct-cli</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Template Authoring Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user-guide/template_authoring.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="template-authoring-guide">
<h1>Template Authoring Guide<a class="headerlink" href="#template-authoring-guide" title="Link to this heading"></a></h1>
<p>Learn how to create powerful Jinja2 templates for ostruct that combine static text with dynamic content, file processing, and advanced filtering capabilities.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide assumes no prior knowledge of Jinja2. Templates use a customized Jinja2 environment with ostruct-specific enhancements.</p>
</div>
</section>
<section id="template-basics">
<h1>Template Basics<a class="headerlink" href="#template-basics" title="Link to this heading"></a></h1>
<section id="template-structure">
<h2>Template Structure<a class="headerlink" href="#template-structure" title="Link to this heading"></a></h2>
<p>ostruct templates are Jinja2 files (typically with <code class="docutils literal notranslate"><span class="pre">.j2</span></code> extension) that can include:</p>
<ul class="simple">
<li><p><strong>Static text</strong> - Regular content that appears as-is</p></li>
<li><p><strong>Variables</strong> - Dynamic content from files, CLI arguments, or system data</p></li>
<li><p><strong>Control structures</strong> - Loops, conditionals, and logic</p></li>
<li><p><strong>Filters</strong> - Functions to process and transform data</p></li>
<li><p><strong>YAML frontmatter</strong> - Configuration and system prompts</p></li>
</ul>
</section>
<section id="basic-template-example">
<h2>Basic Template Example<a class="headerlink" href="#basic-template-example" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">---</span>
<span class="x">system_prompt: You are an expert data analyst.</span>
<span class="x">---</span>
<span class="x">Analyze this configuration file:</span>

<span class="cp">{{</span> <span class="nv">config_yaml.content</span> <span class="cp">}}</span>

<span class="x">Summary of findings:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">logs</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">file.content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">}}</span><span class="x"> words</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="variables-and-data-access">
<h1>Variables and Data Access<a class="headerlink" href="#variables-and-data-access" title="Link to this heading"></a></h1>
<section id="variable-sources">
<h2>Variable Sources<a class="headerlink" href="#variable-sources" title="Link to this heading"></a></h2>
<p>ostruct makes data available through several sources:</p>
<ol class="arabic simple">
<li><p><strong>File Variables</strong> - From file routing options (<code class="docutils literal notranslate"><span class="pre">-ft</span></code>, <code class="docutils literal notranslate"><span class="pre">-fc</span></code>, <code class="docutils literal notranslate"><span class="pre">-fs</span></code>)</p></li>
<li><p><strong>CLI Variables</strong> - From <code class="docutils literal notranslate"><span class="pre">-V</span></code> and <code class="docutils literal notranslate"><span class="pre">-J</span></code> flags</p></li>
<li><p><strong>System Variables</strong> - Built-in ostruct context</p></li>
<li><p><strong>Global Functions</strong> - Template helper functions</p></li>
</ol>
</section>
</section>
<section id="file-variables">
<h1>File Variables<a class="headerlink" href="#file-variables" title="Link to this heading"></a></h1>
<section id="understanding-file-routing">
<h2>Understanding File Routing<a class="headerlink" href="#understanding-file-routing" title="Link to this heading"></a></h2>
<p>Different file routing options make files available in different ways:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Routing Option</p></th>
<th class="head"><p>Variable Access</p></th>
<th class="head"><p>Upload Behavior</p></th>
<th class="head"><p>Use Cases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-ft</span></code> (Template)</p></td>
<td><p>✅ Available</p></td>
<td><p>❌ Not uploaded</p></td>
<td><p>Config files, templates</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-fc</span></code> (Code Interpreter)</p></td>
<td><p>✅ Available</p></td>
<td><p>✅ Uploaded</p></td>
<td><p>Data analysis files</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-fs</span></code> (File Search)</p></td>
<td><p>✅ Available</p></td>
<td><p>✅ Uploaded</p></td>
<td><p>Documents, knowledge bases</p></td>
</tr>
</tbody>
</table>
</section>
<section id="variable-naming-rules">
<h2>Variable Naming Rules<a class="headerlink" href="#variable-naming-rules" title="Link to this heading"></a></h2>
<p>ostruct automatically generates variable names from file paths following these rules:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 35%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File Path</p></th>
<th class="head"><p>Generated Variable</p></th>
<th class="head"><p>Pattern Applied</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config_yaml</span></code></p></td>
<td><p>Replace dots with underscores</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">my-file.txt</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">my_file_txt</span></code></p></td>
<td><p>Replace hyphens with underscores</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hello.world.json</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hello_world_json</span></code></p></td>
<td><p>Replace all non-alphanumeric with underscores</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">123data.csv</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">_123data_csv</span></code></p></td>
<td><p>Prepend underscore if starts with digit</p></td>
</tr>
</tbody>
</table>
</section>
<section id="auto-naming-examples">
<h2>Auto-Naming Examples<a class="headerlink" href="#auto-naming-examples" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Auto-naming syntax</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-ft<span class="w"> </span>config.yaml
<span class="c1"># Creates variable: config_yaml</span>

ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-fc<span class="w"> </span>sales-data.csv
<span class="c1"># Creates variable: sales_data_csv</span>
</pre></div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x"># Access in template</span>
<span class="x">Configuration settings:</span>
<span class="cp">{{</span> <span class="nv">config_yaml.content</span> <span class="cp">}}</span>

<span class="x">Sales data summary:</span>
<span class="cp">{{</span> <span class="nv">sales_data_csv.content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">}}</span><span class="x"> characters</span>
</pre></div>
</div>
</section>
<section id="custom-variable-names">
<h2>Custom Variable Names<a class="headerlink" href="#custom-variable-names" title="Link to this heading"></a></h2>
<p>Override auto-naming with explicit variable names:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Equals syntax</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-ft<span class="w"> </span><span class="nv">app_config</span><span class="o">=</span>config.yaml

<span class="c1"># Two-argument alias syntax</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>--fta<span class="w"> </span>app_config<span class="w"> </span>config.yaml
</pre></div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x"># Access with custom name</span>
<span class="x">Application configuration:</span>
<span class="cp">{{</span> <span class="nv">app_config.content</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="fileinfo-object-structure">
<h2>FileInfo Object Structure<a class="headerlink" href="#fileinfo-object-structure" title="Link to this heading"></a></h2>
<p>Each file variable provides a <code class="docutils literal notranslate"><span class="pre">FileInfo</span></code> object with these attributes:</p>
<p><strong>Content and Path Information:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">file.content</span> <span class="cp">}}</span><span class="x">        &lt;!-- File contents as string --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.path</span> <span class="cp">}}</span><span class="x">           &lt;!-- Relative path from base directory --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.abs_path</span> <span class="cp">}}</span><span class="x">       &lt;!-- Absolute filesystem path --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x">           &lt;!-- File name with extension --&gt;</span>
</pre></div>
</div>
<p><strong>File Properties:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">file.basename</span> <span class="cp">}}</span><span class="x">       &lt;!-- Name without extension --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.ext</span> <span class="cp">}}</span><span class="x">            &lt;!-- Extension (e.g., &quot;txt&quot;) --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.suffix</span> <span class="cp">}}</span><span class="x">         &lt;!-- Extension with dot (e.g., &quot;.txt&quot;) --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.stem</span> <span class="cp">}}</span><span class="x">           &lt;!-- Name without extension --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.dirname</span> <span class="cp">}}</span><span class="x">        &lt;!-- Parent directory name --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.parent</span> <span class="cp">}}</span><span class="x">         &lt;!-- Parent directory path --&gt;</span>
</pre></div>
</div>
<p><strong>Metadata:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="cp">}}</span><span class="x">           &lt;!-- File size in bytes --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.mtime</span> <span class="cp">}}</span><span class="x">          &lt;!-- Modification time --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.encoding</span> <span class="cp">}}</span><span class="x">       &lt;!-- File encoding --&gt;</span>
<span class="cp">{{</span> <span class="nv">file.hash</span> <span class="cp">}}</span><span class="x">           &lt;!-- File hash --&gt;</span>
</pre></div>
</div>
<p><strong>Type Checking:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.exists</span> <span class="cp">%}</span><span class="x">      &lt;!-- File exists --&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.is_file</span> <span class="cp">%}</span><span class="x">     &lt;!-- Is a regular file --&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.is_dir</span> <span class="cp">%}</span><span class="x">      &lt;!-- Is a directory --&gt;</span>
</pre></div>
</div>
</section>
<section id="directory-and-pattern-processing">
<h2>Directory and Pattern Processing<a class="headerlink" href="#directory-and-pattern-processing" title="Link to this heading"></a></h2>
<p>When processing directories or patterns, iterate over file collections:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Directory processing</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-dt<span class="w"> </span>./config_files
</pre></div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Configuration files found:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">config_files</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="cp">}}</span><span class="x"> bytes)</span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">file.content</span> <span class="o">|</span> <span class="nf">truncate</span><span class="o">(</span><span class="m">100</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="cli-variables">
<h1>CLI Variables<a class="headerlink" href="#cli-variables" title="Link to this heading"></a></h1>
<section id="string-variables">
<h2>String Variables<a class="headerlink" href="#string-variables" title="Link to this heading"></a></h2>
<p>Simple string values from the <code class="docutils literal notranslate"><span class="pre">-V</span></code> flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-V<span class="w"> </span><span class="nv">env</span><span class="o">=</span>production<span class="w"> </span>-V<span class="w"> </span><span class="nv">debug</span><span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Environment: </span><span class="cp">{{</span> <span class="nv">env</span> <span class="cp">}}</span>
<span class="x">Debug mode: </span><span class="cp">{{</span> <span class="nv">debug</span> <span class="cp">}}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">env</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span> <span class="cp">%}</span>
<span class="x">Using production settings</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="json-variables">
<h2>JSON Variables<a class="headerlink" href="#json-variables" title="Link to this heading"></a></h2>
<p>Complex data structures from the <code class="docutils literal notranslate"><span class="pre">-J</span></code> flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>-J<span class="w"> </span><span class="nv">config</span><span class="o">=</span><span class="s1">&#39;{&quot;database&quot;:{&quot;host&quot;:&quot;localhost&quot;,&quot;port&quot;:5432},&quot;features&quot;:[&quot;auth&quot;,&quot;billing&quot;]}&#39;</span>
</pre></div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Database configuration:</span>
<span class="x">- Host: </span><span class="cp">{{</span> <span class="nv">config.database.host</span> <span class="cp">}}</span>
<span class="x">- Port: </span><span class="cp">{{</span> <span class="nv">config.database.port</span> <span class="cp">}}</span>

<span class="x">Enabled features:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">feature</span> <span class="k">in</span> <span class="nv">config.features</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">feature</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="control-structures">
<h1>Control Structures<a class="headerlink" href="#control-structures" title="Link to this heading"></a></h1>
<section id="conditional-logic">
<h2>Conditional Logic<a class="headerlink" href="#conditional-logic" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">env</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span> <span class="cp">%}</span>
<span class="x">**PRODUCTION ENVIRONMENT**</span>
<span class="cp">{%</span> <span class="k">elif</span> <span class="nv">env</span> <span class="o">==</span> <span class="s2">&quot;staging&quot;</span> <span class="cp">%}</span>
<span class="x">**STAGING ENVIRONMENT**</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">**DEVELOPMENT ENVIRONMENT**</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.size</span> <span class="o">&gt;</span> <span class="m">1000000</span> <span class="cp">%}</span>
<span class="x">Warning: Large file detected (</span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="o">|</span> <span class="nf">filesizeformat</span> <span class="cp">}}</span><span class="x">)</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="loops-and-iteration">
<h2>Loops and Iteration<a class="headerlink" href="#loops-and-iteration" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Processing </span><span class="cp">{{</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">length</span> <span class="cp">}}</span><span class="x"> files:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nb">loop</span><span class="nv">.index</span> <span class="cp">}}</span><span class="x">. </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span>
<span class="x">   - Size: </span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="cp">}}</span><span class="x"> bytes</span>
<span class="x">   - Modified: </span><span class="cp">{{</span> <span class="nv">file.mtime</span> <span class="cp">}}</span>
<span class="x">   </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.ext</span> <span class="o">==</span> <span class="s2">&quot;py&quot;</span> <span class="cp">%}</span>
<span class="x">   - Python file detected</span>
<span class="x">   </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Loop Variables:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loop.index</span></code> - Current iteration (1-based)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop.index0</span></code> - Current iteration (0-based)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop.first</span></code> - True if first iteration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop.last</span></code> - True if last iteration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop.length</span></code> - Total number of items</p></li>
</ul>
</section>
<section id="filtering-and-grouping">
<h2>Filtering and Grouping<a class="headerlink" href="#filtering-and-grouping" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Python files:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="k">if</span> <span class="nv">file.ext</span> <span class="o">==</span> <span class="s2">&quot;py&quot;</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">Files by extension:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">ext</span><span class="o">,</span> <span class="nv">group</span> <span class="k">in</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">groupby</span><span class="o">(</span><span class="s1">&#39;ext&#39;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">ext</span> <span class="cp">}}</span><span class="x"> files:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">group</span> <span class="cp">%}</span>
<span class="x">  - </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="template-filters">
<h1>Template Filters<a class="headerlink" href="#template-filters" title="Link to this heading"></a></h1>
<section id="text-processing-filters">
<h2>Text Processing Filters<a class="headerlink" href="#text-processing-filters" title="Link to this heading"></a></h2>
<p><strong>Word and Character Counting:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Document statistics:</span>
<span class="x">- Words: </span><span class="cp">{{</span> <span class="nv">content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">}}</span>
<span class="x">- Characters: </span><span class="cp">{{</span> <span class="nv">content</span> <span class="o">|</span> <span class="nf">char_count</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Text Cleaning and Formatting:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Clean code (comments removed):</span>
<span class="cp">{{</span> <span class="nv">source_code</span> <span class="o">|</span> <span class="nf">remove_comments</span> <span class="cp">}}</span>

<span class="x">Normalized text:</span>
<span class="cp">{{</span> <span class="nv">messy_text</span> <span class="o">|</span> <span class="nf">normalize</span> <span class="cp">}}</span>

<span class="x">Wrapped text:</span>
<span class="cp">{{</span> <span class="nv">long_text</span> <span class="o">|</span> <span class="nf">wrap</span><span class="o">(</span><span class="nv">width</span><span class="o">=</span><span class="m">80</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Content Extraction:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Key points:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">keyword</span> <span class="k">in</span> <span class="nv">text</span> <span class="o">|</span> <span class="nf">extract_keywords</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">keyword</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="data-processing-filters">
<h2>Data Processing Filters<a class="headerlink" href="#data-processing-filters" title="Link to this heading"></a></h2>
<p><strong>JSON Handling:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Configuration as JSON:</span>
<span class="cp">{{</span> <span class="nv">config</span> <span class="o">|</span> <span class="nf">to_json</span> <span class="cp">}}</span>

<span class="x">Parsed data:</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">data</span> <span class="o">=</span> <span class="nv">json_string</span> <span class="o">|</span> <span class="nf">from_json</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">data.key</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>List Processing:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Sorted files:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">sort_by</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">Unique extensions:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">ext</span> <span class="k">in</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">extract_field</span><span class="o">(</span><span class="s1">&#39;ext&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">unique</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">ext</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Statistical Analysis:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">File size statistics:</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">stats</span> <span class="o">=</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">extract_field</span><span class="o">(</span><span class="s1">&#39;size&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">aggregate</span> <span class="cp">%}</span>
<span class="x">- Total files: </span><span class="cp">{{</span> <span class="nv">stats.count</span> <span class="cp">}}</span>
<span class="x">- Average size: </span><span class="cp">{{</span> <span class="nv">stats.avg</span> <span class="cp">}}</span>
<span class="x">- Largest: </span><span class="cp">{{</span> <span class="nv">stats.max</span> <span class="cp">}}</span>
<span class="x">- Smallest: </span><span class="cp">{{</span> <span class="nv">stats.min</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="code-processing-filters">
<h2>Code Processing Filters<a class="headerlink" href="#code-processing-filters" title="Link to this heading"></a></h2>
<p><strong>Syntax Highlighting:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Python code with highlighting:</span>
<span class="cp">{{</span> <span class="nv">python_code</span> <span class="o">|</span> <span class="nf">format_code</span><span class="o">(</span><span class="s1">&#39;python&#39;</span><span class="o">)</span> <span class="cp">}}</span>

<span class="x">Auto-detected language:</span>
<span class="cp">{{</span> <span class="nv">code</span> <span class="o">|</span> <span class="nf">format_code</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Comment Handling:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Code without comments:</span>
<span class="cp">{{</span> <span class="nv">source</span> <span class="o">|</span> <span class="nf">strip_comments</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="table-and-data-formatting">
<h2>Table and Data Formatting<a class="headerlink" href="#table-and-data-formatting" title="Link to this heading"></a></h2>
<p><strong>Automatic Table Generation:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">File listing:</span>
<span class="cp">{{</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">auto_table</span> <span class="cp">}}</span>

<span class="x">Custom table:</span>
<span class="cp">{{</span> <span class="nv">data</span> <span class="o">|</span> <span class="nf">dict_to_table</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="global-functions">
<h1>Global Functions<a class="headerlink" href="#global-functions" title="Link to this heading"></a></h1>
<section id="token-estimation">
<h2>Token Estimation<a class="headerlink" href="#token-estimation" title="Link to this heading"></a></h2>
<p>Estimate tokens for content planning:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Content size: </span><span class="cp">{{</span> <span class="nv">estimate_tokens</span><span class="o">(</span><span class="nv">large_text</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> tokens</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">estimate_tokens</span><span class="o">(</span><span class="nv">content</span><span class="o">)</span> <span class="o">&gt;</span> <span class="m">4000</span> <span class="cp">%}</span>
<span class="x">Warning: Content may exceed context limits</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="utility-functions">
<h2>Utility Functions<a class="headerlink" href="#utility-functions" title="Link to this heading"></a></h2>
<p><strong>Date and Time:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Generated at: </span><span class="cp">{{</span> <span class="nv">now</span><span class="o">()</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Debugging:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Debug info: </span><span class="cp">{{</span> <span class="nv">debug</span><span class="o">(</span><span class="nv">complex_variable</span><span class="o">)</span> <span class="cp">}}</span>
<span class="x">Variable type: </span><span class="cp">{{</span> <span class="nv">type_of</span><span class="o">(</span><span class="nv">variable</span><span class="o">)</span> <span class="cp">}}</span>
<span class="x">Available attributes: </span><span class="cp">{{</span> <span class="nv">dir_of</span><span class="o">(</span><span class="nv">object</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Validation:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">validate_json</span><span class="o">(</span><span class="nv">json_string</span><span class="o">,</span> <span class="nv">schema</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">JSON is valid</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">JSON validation failed</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="system-prompts-and-frontmatter">
<h1>System Prompts and Frontmatter<a class="headerlink" href="#system-prompts-and-frontmatter" title="Link to this heading"></a></h1>
<section id="yaml-frontmatter">
<h2>YAML Frontmatter<a class="headerlink" href="#yaml-frontmatter" title="Link to this heading"></a></h2>
<p>Add configuration and system prompts to templates using YAML frontmatter:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">---</span>
<span class="x">system_prompt: |</span>
<span class="x">  You are an expert software architect with deep knowledge of</span>
<span class="x">  system design patterns and best practices.</span>
<span class="x">model: gpt-4o</span>
<span class="x">temperature: 0.3</span>
<span class="x">---</span>
<span class="x">Analyze this system architecture:</span>

<span class="cp">{{</span> <span class="nv">architecture_doc.content</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="system-prompt-best-practices">
<h2>System Prompt Best Practices<a class="headerlink" href="#system-prompt-best-practices" title="Link to this heading"></a></h2>
<p><strong>Clear Role Definition:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a senior security analyst specializing in application security.</span>
<span class="w">  </span><span class="no">Focus on identifying potential vulnerabilities and security best practices.</span>
<span class="nn">---</span>
</pre></div>
</div>
<p><strong>Context-Specific Instructions:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are analyzing {{ env }} environment configuration files.</span>
<span class="w">  </span><span class="no">Pay attention to security settings, resource allocation, and compliance requirements.</span>
<span class="w">  </span><span class="no">Provide actionable recommendations for {{ env }} deployment.</span>
<span class="nn">---</span>
</pre></div>
</div>
<p><strong>Output Format Guidance:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">Analyze the provided code and return findings in the exact JSON schema format specified.</span>
<span class="w">  </span><span class="no">Focus on actionable feedback with specific line numbers and concrete suggestions.</span>
<span class="nn">---</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-template-patterns">
<h1>Advanced Template Patterns<a class="headerlink" href="#advanced-template-patterns" title="Link to this heading"></a></h1>
<section id="multi-file-analysis-template">
<h2>Multi-File Analysis Template<a class="headerlink" href="#multi-file-analysis-template" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">---</span>
<span class="x">system_prompt: You are a code review expert analyzing a multi-file codebase.</span>
<span class="x">---</span>
<span class="x"># Code Review Analysis</span>

<span class="x">## Files Analyzed</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">source_files</span> <span class="cp">%}</span>
<span class="x">- **</span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x">** (</span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="cp">}}</span><span class="x"> bytes, </span><span class="cp">{{</span> <span class="nv">file.content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">}}</span><span class="x"> words)</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">## Security Concerns</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">source_files</span> <span class="k">if</span> <span class="s1">&#39;password&#39;</span> <span class="k">in</span> <span class="nv">file.content.lower</span><span class="o">()</span> <span class="k">or</span> <span class="s1">&#39;secret&#39;</span> <span class="k">in</span> <span class="nv">file.content.lower</span><span class="o">()</span> <span class="cp">%}</span>
<span class="x">⚠️ **</span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x">**: Potential credential exposure detected</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">## Code Quality Metrics</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">total_lines</span> <span class="o">=</span> <span class="nv">source_files</span> <span class="o">|</span> <span class="nf">sum</span><span class="o">(</span><span class="nv">attribute</span><span class="o">=</span><span class="s1">&#39;content&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">%}</span>
<span class="x">- Total lines across all files: </span><span class="cp">{{</span> <span class="nv">total_lines</span> <span class="cp">}}</span>
<span class="x">- Average file size: </span><span class="cp">{{</span> <span class="o">(</span><span class="nv">source_files</span> <span class="o">|</span> <span class="nf">extract_field</span><span class="o">(</span><span class="s1">&#39;size&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">sum</span><span class="o">)</span> <span class="o">//</span> <span class="o">(</span><span class="nv">source_files</span> <span class="o">|</span> <span class="nf">length</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> bytes</span>

<span class="x">## Detailed Analysis</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">source_files</span> <span class="cp">%}</span>
<span class="x">### </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span>
<span class="x">```</span><span class="cp">{{</span> <span class="nv">file.ext</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">file.content</span> <span class="cp">}}</span>
<span class="x">```</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="configuration-comparison-template">
<h2>Configuration Comparison Template<a class="headerlink" href="#configuration-comparison-template" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">---</span>
<span class="x">system_prompt: You are a DevOps engineer comparing environment configurations.</span>
<span class="x">---</span>
<span class="x"># Configuration Comparison: </span><span class="cp">{{</span> <span class="nv">env1</span> <span class="cp">}}</span><span class="x"> vs </span><span class="cp">{{</span> <span class="nv">env2</span> <span class="cp">}}</span>

<span class="x">## </span><span class="cp">{{</span> <span class="nv">env1</span> <span class="o">|</span> <span class="nf">title</span> <span class="cp">}}</span><span class="x"> Configuration</span>
<span class="x">```yaml</span>
<span class="cp">{{</span> <span class="nv">config1.content</span> <span class="cp">}}</span>
<span class="x">```</span>

<span class="x">## </span><span class="cp">{{</span> <span class="nv">env2</span> <span class="o">|</span> <span class="nf">title</span> <span class="cp">}}</span><span class="x"> Configuration</span>
<span class="x">```yaml</span>
<span class="cp">{{</span> <span class="nv">config2.content</span> <span class="cp">}}</span>
<span class="x">```</span>

<span class="x">## Analysis Request</span>
<span class="x">Compare these configurations and identify:</span>
<span class="x">1. **Security differences** - Authentication, encryption, access controls</span>
<span class="x">2. **Resource allocation** - CPU, memory, storage differences</span>
<span class="x">3. **Feature flags** - Enabled/disabled features</span>
<span class="x">4. **Environment-specific settings** - URLs, database connections</span>
<span class="x">5. **Potential issues** - Misconfigurations or inconsistencies</span>
</pre></div>
</div>
</section>
<section id="data-analysis-template">
<h2>Data Analysis Template<a class="headerlink" href="#data-analysis-template" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">---</span>
<span class="x">system_prompt: You are a data scientist analyzing business metrics.</span>
<span class="x">---</span>
<span class="x"># Data Analysis Report</span>

<span class="x">## Dataset Overview</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">dataset</span> <span class="k">in</span> <span class="nv">datasets</span> <span class="cp">%}</span>
<span class="x">**</span><span class="cp">{{</span> <span class="nv">dataset.name</span> <span class="cp">}}</span><span class="x">**:</span>
<span class="x">- Size: </span><span class="cp">{{</span> <span class="nv">dataset.content</span> <span class="o">|</span> <span class="nf">char_count</span> <span class="cp">}}</span><span class="x"> characters</span>
<span class="x">- Estimated records: </span><span class="cp">{{</span> <span class="nv">dataset.content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="o">//</span> <span class="m">10</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">## Analysis Parameters</span>
<span class="x">- Analysis type: </span><span class="cp">{{</span> <span class="nv">analysis_type</span> <span class="cp">}}</span>
<span class="x">- Date range: </span><span class="cp">{{</span> <span class="nv">date_range</span> <span class="cp">}}</span>
<span class="x">- Metrics focus: </span><span class="cp">{{</span> <span class="nv">metrics.join</span><span class="o">(</span><span class="s1">&#39;, &#39;</span><span class="o">)</span> <span class="cp">}}</span>

<span class="x">## Raw Data</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">dataset</span> <span class="k">in</span> <span class="nv">datasets</span> <span class="cp">%}</span>
<span class="x">### </span><span class="cp">{{</span> <span class="nv">dataset.name</span> <span class="cp">}}</span>
<span class="x">```</span>
<span class="cp">{{</span> <span class="nv">dataset.content</span> <span class="cp">}}</span>
<span class="x">```</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">Please analyze this data focusing on trends, anomalies, and business insights.</span>
</pre></div>
</div>
</section>
</section>
<section id="tool-integration-variables">
<h1>Tool Integration Variables<a class="headerlink" href="#tool-integration-variables" title="Link to this heading"></a></h1>
<section id="code-interpreter-context">
<h2>Code Interpreter Context<a class="headerlink" href="#code-interpreter-context" title="Link to this heading"></a></h2>
<p>When files are routed to Code Interpreter (<code class="docutils literal notranslate"><span class="pre">-fc</span></code>), additional context is available:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Data files available for analysis:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">code_interpreter_files</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x"> (uploaded for Python analysis)</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">Please analyze the uploaded data and generate visualizations showing:</span>
<span class="x">1. Key trends over time</span>
<span class="x">2. Distribution patterns</span>
<span class="x">3. Correlation analysis</span>
</pre></div>
</div>
</section>
<section id="file-search-context">
<h2>File Search Context<a class="headerlink" href="#file-search-context" title="Link to this heading"></a></h2>
<p>When files are routed to File Search (<code class="docutils literal notranslate"><span class="pre">-fs</span></code>), they’re available for semantic search:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">Knowledge base documents:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">search_files</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x"> (available for semantic search)</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">Use the uploaded documents to answer questions about </span><span class="cp">{{</span> <span class="nv">topic</span> <span class="cp">}}</span><span class="x">.</span>
<span class="x">Provide specific references to source documents in your responses.</span>
</pre></div>
</div>
</section>
</section>
<section id="template-organization-and-reuse">
<h1>Template Organization and Reuse<a class="headerlink" href="#template-organization-and-reuse" title="Link to this heading"></a></h1>
<section id="template-libraries">
<h2>Template Libraries<a class="headerlink" href="#template-libraries" title="Link to this heading"></a></h2>
<p>Organize templates by use case:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>templates/
├── analysis/
│   ├── code_review.j2
│   ├── security_scan.j2
│   └── performance_analysis.j2
├── reporting/
│   ├── daily_summary.j2
│   └── incident_report.j2
└── configuration/
    ├── env_comparison.j2
    └── deployment_check.j2
</pre></div>
</div>
</section>
<section id="reusable-template-snippets">
<h2>Reusable Template Snippets<a class="headerlink" href="#reusable-template-snippets" title="Link to this heading"></a></h2>
<p>Create modular template components:</p>
<p><strong>File listing snippet:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# files_table.j2 #}</span>
<span class="cp">{%</span> <span class="k">macro</span> <span class="nv">file_table</span><span class="o">(</span><span class="nv">files</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">| File | Size | Modified |</span>
<span class="x">|------|------|----------|</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="x">| </span><span class="cp">{{</span> <span class="nv">file.name</span> <span class="cp">}}</span><span class="x"> | </span><span class="cp">{{</span> <span class="nv">file.size</span> <span class="cp">}}</span><span class="x"> | </span><span class="cp">{{</span> <span class="nv">file.mtime</span> <span class="cp">}}</span><span class="x"> |</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Security check snippet:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# security_checks.j2 #}</span>
<span class="cp">{%</span> <span class="k">macro</span> <span class="nv">security_scan</span><span class="o">(</span><span class="nv">content</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">issues</span> <span class="o">=</span> <span class="o">[]</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;password&#39;</span> <span class="k">in</span> <span class="nv">content.lower</span><span class="o">()</span> <span class="cp">%}{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">issues.append</span><span class="o">(</span><span class="s1">&#39;Hardcoded passwords detected&#39;</span><span class="o">)</span> <span class="cp">%}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;api_key&#39;</span> <span class="k">in</span> <span class="nv">content.lower</span><span class="o">()</span> <span class="cp">%}{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">issues.append</span><span class="o">(</span><span class="s1">&#39;API keys in code&#39;</span><span class="o">)</span> <span class="cp">%}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">issues</span> <span class="cp">%}</span>
<span class="x">⚠️ Security Issues:</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">issue</span> <span class="k">in</span> <span class="nv">issues</span> <span class="cp">%}</span>
<span class="x">- </span><span class="cp">{{</span> <span class="nv">issue</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="template-testing-and-debugging">
<h1>Template Testing and Debugging<a class="headerlink" href="#template-testing-and-debugging" title="Link to this heading"></a></h1>
<section id="dry-run-testing">
<h2>Dry Run Testing<a class="headerlink" href="#dry-run-testing" title="Link to this heading"></a></h2>
<p>Test templates without API calls:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test template rendering</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>--dry-run<span class="w"> </span>-ft<span class="w"> </span>config.yaml

<span class="c1"># Verbose output for debugging</span>
ostruct<span class="w"> </span>run<span class="w"> </span>template.j2<span class="w"> </span>schema.json<span class="w"> </span>--dry-run<span class="w"> </span>--verbose<span class="w"> </span>-ft<span class="w"> </span>data.csv
</pre></div>
</div>
</section>
<section id="debug-variables">
<h2>Debug Variables<a class="headerlink" href="#debug-variables" title="Link to this heading"></a></h2>
<p>Use debug functions in templates:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Debug variable contents #}</span>
<span class="x">Debug info: </span><span class="cp">{{</span> <span class="nv">debug</span><span class="o">(</span><span class="nv">config</span><span class="o">)</span> <span class="cp">}}</span>

<span class="c">{# Check variable types #}</span>
<span class="x">Type of data: </span><span class="cp">{{</span> <span class="nv">type_of</span><span class="o">(</span><span class="nv">data</span><span class="o">)</span> <span class="cp">}}</span>

<span class="c">{# List available attributes #}</span>
<span class="x">Available methods: </span><span class="cp">{{</span> <span class="nv">dir_of</span><span class="o">(</span><span class="nv">file_object</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="common-template-issues">
<h2>Common Template Issues<a class="headerlink" href="#common-template-issues" title="Link to this heading"></a></h2>
<p><strong>Variable naming conflicts:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Wrong - conflicts with built-in #}</span>
<span class="cp">{{</span> <span class="nv">list.content</span> <span class="cp">}}</span>

<span class="c">{# Right - descriptive names #}</span>
<span class="cp">{{</span> <span class="nv">file_list.content</span> <span class="cp">}}</span>
</pre></div>
</div>
<p><strong>Missing file checks:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Wrong - may fail if file missing #}</span>
<span class="cp">{{</span> <span class="nv">config.content</span> <span class="cp">}}</span>

<span class="c">{# Right - defensive programming #}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">config</span> <span class="k">and</span> <span class="nv">config.exists</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">config.content</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">No configuration file found</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><strong>Inefficient loops:</strong></p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Inefficient - nested processing #}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">line</span> <span class="k">in</span> <span class="nv">file.content.split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">Process line: </span><span class="cp">{{</span> <span class="nv">line</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="c">{# Better - use filters #}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="x">Lines: </span><span class="cp">{{</span> <span class="nv">file.content</span> <span class="o">|</span> <span class="nf">word_count</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h1>
<section id="template-design">
<h2>Template Design<a class="headerlink" href="#template-design" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Clear structure</strong> - Use consistent formatting and organization</p></li>
<li><p><strong>Defensive coding</strong> - Check for variable existence before use</p></li>
<li><p><strong>Meaningful names</strong> - Use descriptive variable names</p></li>
<li><p><strong>Modular design</strong> - Break complex templates into reusable components</p></li>
<li><p><strong>Documentation</strong> - Comment complex logic and requirements</p></li>
</ol>
</section>
<section id="performance-optimization">
<h2>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Filter efficiently</strong> - Use filters instead of loops when possible</p></li>
<li><p><strong>Cache expensive operations</strong> - Store results in variables</p></li>
<li><p><strong>Limit content size</strong> - Use <code class="docutils literal notranslate"><span class="pre">truncate</span></code> for large files</p></li>
<li><p><strong>Smart iteration</strong> - Filter before iterating over large collections</p></li>
</ol>
</section>
<section id="security-considerations">
<h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Sanitize inputs</strong> - Use <code class="docutils literal notranslate"><span class="pre">escape</span></code> filter for user content</p></li>
<li><p><strong>Validate data</strong> - Check file existence and formats</p></li>
<li><p><strong>Limit exposure</strong> - Don’t include sensitive data in templates</p></li>
<li><p><strong>Review outputs</strong> - Ensure templates don’t leak credentials</p></li>
</ol>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h2>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="c">{# Graceful error handling #}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">file</span> <span class="k">in</span> <span class="nv">files</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">file.exists</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">file.content</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">File not found: </span><span class="cp">{{</span> <span class="nv">file.path</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">No files provided for analysis</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
<section id="next-steps">
<h1>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="quickstart.html"><span class="doc">Quick Start Guide</span></a> - Learn with hands-on examples</p></li>
<li><p><a class="reference internal" href="cli_reference.html"><span class="doc">CLI Reference</span></a> - Complete CLI option reference</p></li>
<li><p><a class="reference internal" href="../security/overview.html"><span class="doc">Security Overview</span></a> - Security considerations for templates</p></li>
<li><p><a class="reference external" href="https://jinja.palletsprojects.com/">Jinja2 Documentation</a> - Advanced Jinja2 features</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli_reference.html" class="btn btn-neutral float-left" title="CLI Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../security/overview.html" class="btn btn-neutral float-right" title="Security Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Yaniv Golan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
